
<html>
  <head>
    <title>ArtNet switcher</title>
    <style>
      /* Stage Lighting Control - Dark Mode Stylesheet */

:root {
  /* Core Colors */
  --bg-primary: #0a0a0f;
  --bg-secondary: #16161f;
  --bg-tertiary: #1e1e2b;
  --bg-elevated: #252532;
  
  /* Lighting Accents */
  --accent-cyan: #00d9ff;
  --accent-magenta: #ff00aa;
  --accent-yellow: #ffd700;
  --accent-warm: #ff6b35;
  
  /* Text Colors */
  --text-primary: #e8e8f0;
  --text-secondary: #a8a8b8;
  --text-muted: #6b6b7b;
  
  /* Borders & Dividers */
  --border-subtle: #2a2a38;
  --border-medium: #3a3a48;
  --border-bright: #4a4a58;
  
  /* Status Colors */
  --status-active: #00ff88;
  --status-standby: #ffaa00;
  --status-error: #ff4444;
  --status-inactive: #444455;
  
  /* Glow Effects */
  --glow-cyan: 0 0 20px rgba(0, 217, 255, 0.3);
  --glow-magenta: 0 0 20px rgba(255, 0, 170, 0.3);
  --glow-active: 0 0 15px rgba(0, 255, 136, 0.4);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: linear-gradient(135deg, var(--bg-primary) 0%, #0d0d15 100%);
  color: var(--text-primary);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', sans-serif;
  line-height: 1.6;
  min-height: 100vh;
}

/* Header Styles */
header {
  background: var(--bg-secondary);
  border-bottom: 2px solid var(--border-medium);
  padding: 1.5rem 2rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

h1, h2, h3 {
  color: var(--text-primary);
  font-weight: 600;
  letter-spacing: 0.5px;
}

h1 {
  font-size: 2rem;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-magenta));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Button Styles */
button {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  border: 1px solid var(--border-medium);
  padding: 0.75rem 1.5rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 500;
  transition: all 0.2s ease;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

button:hover {
  background: var(--bg-elevated);
  border-color: var(--accent-cyan);
  box-shadow: var(--glow-cyan);
  transform: translateY(-1px);
}

button:active {
  transform: translateY(0);
}

button.primary {
  background: linear-gradient(135deg, var(--accent-cyan), #00b8d4);
  border-color: var(--accent-cyan);
  color: var(--bg-primary);
  font-weight: 600;
}

button.primary:hover {
  box-shadow: var(--glow-cyan), 0 4px 12px rgba(0, 217, 255, 0.3);
}

button.active {
  background: var(--status-active);
  border-color: var(--status-active);
  color: var(--bg-primary);
  box-shadow: var(--glow-active);
}

/* Input Styles */
input, select, textarea {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--border-medium);
  padding: 0.75rem 1rem;
  border-radius: 6px;
  font-size: 0.95rem;
  transition: all 0.2s ease;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--accent-cyan);
  box-shadow: var(--glow-cyan);
}

input[type="range"] {
  -webkit-appearance: none;
  height: 6px;
  background: var(--bg-tertiary);
  border-radius: 3px;
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  background: var(--accent-cyan);
  border-radius: 50%;
  cursor: pointer;
  box-shadow: var(--glow-cyan);
}

/* Checkbox Styles */
input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  background: var(--bg-secondary);
  border: 2px solid var(--border-medium);
  border-radius: 4px;
  cursor: pointer;
  position: relative;
  transition: all 0.2s ease;
  margin: 0;
  padding: 0;
}

input[type="checkbox"]:hover {
  border-color: var(--accent-cyan);
  box-shadow: var(--glow-cyan);
}

input[type="checkbox"]:checked {
  background: var(--accent-cyan);
  border-color: var(--accent-cyan);
  box-shadow: var(--glow-cyan);
}

input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 5px;
  top: 2px;
  width: 6px;
  height: 10px;
  border: solid var(--bg-primary);
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

input[type="checkbox"]:focus {
  outline: none;
  border-color: var(--accent-cyan);
  box-shadow: var(--glow-cyan), 0 0 0 3px rgba(0, 217, 255, 0.1);
}

input[type="checkbox"]:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

hr {
  height: 1px;
  margin: 50px 0;
  background: -webkit-gradient(linear, 0 0, 100% 0, from(rgba(0, 0, 0, 0)), color-stop(0.5, #333333), to(rgba(0, 0, 0, 0)));
  background: -webkit-linear-gradient(left, rgba(0, 0, 0, 0), #333333, rgba(0, 0, 0, 0));
  background: -moz-linear-gradient(left, rgba(0, 0, 0, 0), #333333, rgba(0, 0, 0, 0));
  background: -o-linear-gradient(left, rgba(0, 0, 0, 0), #333333, rgba(0, 0, 0, 0));
  background: linear-gradient(left, rgba(0, 0, 0, 0), #333333, rgba(0, 0, 0, 0));
  border: 0;
}
hr:after {
  display: block;
  content: '';
  height: 30px;
  background-image: -webkit-gradient(radial, 50% 0%, 0, 50% 0%, 116, color-stop(0%, #cccccc), color-stop(100%, rgba(255, 255, 255, 0)));
  background-image: -webkit-radial-gradient(center top, farthest-side, #cccccc 0%, rgba(255, 255, 255, 0) 100%);
  background-image: -moz-radial-gradient(center top, farthest-side, #cccccc 0%, rgba(255, 255, 255, 0) 100%);
  background-image: -o-radial-gradient(center top, farthest-side, #cccccc 0%, rgba(255, 255, 255, 0) 100%);
  background-image: radial-gradient(farthest-side at center top, #cccccc 0%, rgba(255, 255, 255, 0) 100%);
}
    </style>

  <script src="node_modules/@dataparty/api/dist/dataparty-browser.js"></script>
  <script src="node_modules/argon2-browser/dist/argon2-bundled.min.js"></script>

  </head>
  <body>


    <br>
    <br>

    <center>
    <div>
      
      <form>
        <ul>
          <li>
            <label>Your Identity</label> <input id="your-identity" type="string" readonly="readonly">
          </li>
          <li>
            <label>Your IP</label> <input id="your-ip" type="string" readonly="readonly">
          </li>
          <li>
            <label>Current State</label><br><textarea id="current-state" readonly="readonly" rows="10" cols="45"></textarea>
          </li>

          <hr>

          <li>
            <label>Mode</label>
            <select id="mode">
              <option value="artnetproxy">ArtNet Proxy</option>
              <!--<option value="ola">OLA</option>
              <option value="api">webapi</option> -->
              <option value="ha">Home Assistant</option>
            </select>
          </li>
          <li>
            <label>Allowed IP</label> <input id="allowed-ip" type="string" placeholder="10.20.110.x, 10.20.110.y">
          </li>
          <li hidden>
            <label>Allowed Actor</label> <input id="allowed-actor" type="string" placeholder="base64 hash">
          </li>
          <li>
            <label>Duration</label>
            <select id="duration">
              <option value="10m">10 min</option>
              <option value="1h">1 hour</option>
              <option value="4h">4 hours</option>
              <option value="24h">24 hours</option>
              <option value="forever">Fowever</option>
            </select>
          </li>
        </ul>

        <br>
        <br>

        <button onclick="claimInterface(event)">Claim</button>
        <button onclick="releaseInterface(event)">Release</button>

        <hr>

        <table>
          <tr>
            <td><h1>1</h1></td>
            <td>
              <button>black</button>
            </td>
            <td>
              <button>white</button>
            </td>
          </tr>
          <tr>
            <td><h1>2</h1></td>
            <td>
              <button>black</button>
            </td>
            <td>
              <button>white</button>
            </td>
          </tr>
          <tr>
            <td><h1>3</h1></td>
            <td>
              <button>black</button>
            </td>
            <td>
              <button>white</button>
            </td>
          </tr>
          <tr>
            <td><h1>4s</h1></td>
            <td>
              <button>black</button>
            </td>
            <td>
              <button>white</button>
            </td>
          </tr>
        </table>
        

      </form>
    </div>
    </center>


    <script>

let part = null

let config = new Dataparty.Config.LocalStorageConfig({
  basePath:'',
  cloud: {
    uri: 'https://' + window.location.hostname + ':3000'
  }
})

async function claimInterface(event){
  console.log('do claim')
  event.preventDefault()

  let durationText = document.getElementById('duration').value
  let expiry = Date.now()

  switch(durationText){
    case '10m':
      expiry += 10*60*1000
      break
    case '1h':
      expiry += 60*60*1000
      break
    case '4h':
      expiry += 4*60*60*1000
      break
    case '24h':
    case 'forever':
      expiry += 24*60*60*1000
      break
  }

  let allowedIP = document.getElementById('allowed-ip').value
  let allowedActor = document.getElementById('allowed-actor').value

  if(allowedIP.length == 0){
    allowedIP = []
  } else { allowedIP = allowedIP.split(',') }

  if(allowedActor.length == 0){
    allowedActor = []
  } else { allowedActor = allowedActor.split(',') }

  const config ={
    //node: '',
    mode: document.getElementById('mode').value,
    allowedIP,
    allowedActor,
    allowInterrupt: true,
    expiry
  }

  console.log('claim config', config)

  const claimResult = await party.comms.call('claim-interface', config, {
    expectClearTextReply: false,
    sendClearTextRequest: false,
    useSessions: false
  })


  document.getElementById('current-state').value = JSON.stringify(claimResult.state, null, 2)


}

async function releaseInterface(event) {
  console.log('do release')
  event.preventDefault()


  const releaseResult = await party.comms.call('release-interface', {}, {
    expectClearTextReply: false,
    sendClearTextRequest: false,
    useSessions: false
  })


  document.getElementById('current-state').value = JSON.stringify(releaseResult.state, null, 2)

}

async function init(){

  party = new Dataparty.LokiParty({
    path: 'artnet-party-client',
    dbAdapter: new Dataparty.LokiDb.LokiLocalStorageAdapter(),
    config
  })

  await party.start()

  if(!party.comms){
    party.comms = new Dataparty.Comms.RestComms({
      party,
      config: party.config
    })
  }

  console.log('my identity -', party.identity)

  let claimData = {
    node: 'dma-artnet0',
    mode: 'artnetproxy',
    allowedIP: [],
    allowedActor: [],
    expiry: 111010101
  }

  const getIpResult = await party.comms.call('get-ip', {}, {
    expectClearTextReply: false,
    sendClearTextRequest: false,
    useSessions: false
  })


  document.getElementById('your-ip').value = getIpResult.ip
  document.getElementById('allowed-ip').value = getIpResult.ip

  document.getElementById('your-identity').value = party.identity.key.public.sign

  console.log(getIpResult)

  const getStateResult = await party.comms.call('get-state', {}, {
    expectClearTextReply: false,
    sendClearTextRequest: false,
    useSessions: false
  })

  console.log(getStateResult)

  document.getElementById('current-state').value = JSON.stringify(getStateResult.state, null, 2)

}


init().catch((err)=>{
  console.error('crashed', err)
})

 

    </script>
  </body>

</html>